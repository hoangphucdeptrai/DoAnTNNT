<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sáº£n pháº©m AI Tracking</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; background: #f0f2f5; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .img-placeholder { width: 100%; height: 300px; background: #ddd; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .admin-box { margin-top: 30px; padding: 15px; background: #2c3e50; color: white; border-radius: 8px; }
        h1 { color: #333; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=800" alt="Äiá»‡n thoáº¡i" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;">
        <h1>Äiá»‡n thoáº¡i thÃ´ng minh Super AI</h1>
        <p>
            ÄÃ¢y lÃ  Ä‘oáº¡n vÄƒn báº£n mÃ´ táº£ sáº£n pháº©m. Báº¡n hÃ£y Ä‘á»c nÃ³. 
            Há»‡ thá»‘ng Ä‘ang Ã¢m tháº§m Ä‘o lÆ°á»ng xem báº¡n Ä‘á»c Ä‘oáº¡n nÃ y máº¥t bao lÃ¢u.
            Dá»¯ liá»‡u cá»§a báº¡n sáº½ Ä‘Æ°á»£c gá»­i vá» Server Ä‘á»ƒ lÃ m thÃ´ng minh hÆ¡n cho thuáº­t toÃ¡n Há»“i quy tuyáº¿n tÃ­nh.
        </p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        <button onclick="alert('ÄÃ£ thÃªm vÃ o giá»!')" style="padding: 10px 20px; background: blue; color: white; border: none; cursor: pointer;">Mua Ngay</button>

        <div class="admin-box">
            <h3>ğŸ¤– AI Analytics (Real-time)</h3>
            <p>Sá»‘ ngÆ°á»i Ä‘Ã£ Ä‘Ã³ng gÃ³p dá»¯ liá»‡u: <strong id="user-count">...</strong> ngÆ°á»i</p>
            <p>â±ï¸ Thá»i gian trung bÃ¬nh má»i ngÆ°á»i xem: <strong id="avg-time" style="color: #3498db;">...</strong> giÃ¢y</p>
            <p>ğŸ“Š Thá»i gian ngáº¯n nháº¥t / dÃ i nháº¥t: <strong id="min-time">...</strong>s / <strong id="max-time">...</strong>s</p>
            <p>ğŸ”® AI Dá»± Ä‘oÃ¡n báº¡n sáº½ xem trong: <strong id="pred-time" style="color: yellow;">...</strong> giÃ¢y</p>
            <p>â° Thá»i gian báº¡n Ä‘ang xem thá»±c táº¿: <strong id="real-time" style="color: #2ecc71;">0</strong> giÃ¢y</p>
        </div>
    </div>

    <script>
        let startTime = Date.now();
        let wordCount = 300; // Giáº£ Ä‘á»‹nh bÃ i nÃ y 300 tá»«
        let imageCount = 1;
        let loadTime = 1.2;
        let isDesktop = window.innerWidth > 768 ? 1 : 0;

        // 1. Khi vÃ o trang: Gá»i lÃªn Server Ä‘á»ƒ xin dá»± Ä‘oÃ¡n
        fetch('/predict', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                word_count: wordCount,
                image_count: imageCount,
                load_time: loadTime,
                is_desktop: isDesktop
            })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('pred-time').innerText = data.prediction;
            document.getElementById('user-count').innerText = data.data_count;
            document.getElementById('avg-time').innerText = data.avg_time;
            document.getElementById('min-time').innerText = data.min_time;
            document.getElementById('max-time').innerText = data.max_time;
        });

        // 2. Bá»™ Ä‘áº¿m giá» hiá»ƒn thá»‹ cho vui
        setInterval(() => {
            let seconds = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('real-time').innerText = seconds;
        }, 1000);

        // 3. QUAN TRá»ŒNG: Gá»­i dá»¯ liá»‡u vá» Server khi ngÆ°á»i dÃ¹ng rá»i trang
        // LÆ°u Ã½: visibilitychange tin cáº­y hÆ¡n unload trÃªn mobile
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                sendData();
            }
        });

        function sendData() {
            let timeSpent = (Date.now() - startTime) / 1000;
            
            // Sá»­ dá»¥ng navigator.sendBeacon Ä‘á»ƒ gá»­i dá»¯ liá»‡u ká»ƒ cáº£ khi tab Ä‘Ã£ Ä‘Ã³ng
            let data = JSON.stringify({
                word_count: wordCount,
                image_count: imageCount,
                load_time: loadTime,
                is_desktop: isDesktop,
                time_on_page: timeSpent
            });
            
            navigator.sendBeacon('/save_data', new Blob([data], {type: 'application/json'}));
        }
    </script>
</body>
</html>
